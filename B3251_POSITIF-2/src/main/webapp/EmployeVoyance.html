<!DOCTYPE html>
<!--
To change this license header, choose License Headers in Project Properties.
To change this template file, choose Tools | Templates
and open the template in the editor.
-->
<html>
     <head>
        
        <link rel="stylesheet" href="style.css" type="text/css"/>
        <style>
        .header 
        {
            cursor: default;
            border: 3px #95BAE0 solid;
            background-color: #95BAE0;
        }
        body 
        {
            background-color: #FFFFFF;
        }
        li#bouton-tabBord
        {
            float: left;
            width: 50%;
        }
        li#bouton-deconnexion {
        }
        
        ul
        {
            list-style: none    
        }
        

        </style>
        <title>Positif - Voyance</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
    </head>
    <body id='body'>
        <ul class="header">
        <li id="bouton-tabBord"> <h3> Tableau de bord </h3> </li>  
        <li id="bouton-deconnexion"> <h3> Deconnexion </h3> </li>  
        </ul>
        <br>
        
        <h2 id="voyance">Voyance attribuée : </h2>
        <h3> Profil Client </h3> <br>
        Civilité : <div id="champ-civilite"></div><br>
        Nom : <div id="champ-nom"></div><br>
        Prénom : <div id="champ-prenom"></div><br>
        Date de Naissance : <div id="champ-dateNaissance"></div><br>
        Tel : <div id="champ-tel"></div><br>
        Mail : <div id="champ-mail"></div><br>
        <h3> Astrologie  </h3> <br>
        Signe astrologique : <div id='sgnAstro'> </div> <br>
        Signe chinois : <div id='sgnChinois'> </div> <br>
        Animal totem : <div id='aniTotem'> </div> <br>
        Couleur porte-bonheur : <div id='couleurBonheur'> </div> <br>
        <h2> Medium à incarner  </h2> <br>
        Nom : <div id='nomMedium'> </div> <br>
        Medium : <div id='medium'> </div> <br>
        Description : <div id='description'> </div> <br>
        <div id='specialite'> </div> <br>
        <div id='formation'> </div> <br>
        <div id='promotion'> </div> <br>
        <table id='tableau' border="1" width="100%">
            <tr>
                <td> Medium </td>
                <td> Type de médium </td>
                <td> Commentaire </td>
            </tr>
        </table> 
        <h2> Générateur de Prédiction </h2>
        
        
        
        <div id="valeur_coeur"> 3 </div>
        <input type="range" value="3" max="4" min="1" step="1" id="selec_coeur">
        <div id="comm_coeur"> </div>
        <div id="valeur_sante"> 3 </div>
        <input type="range" value="3" max="4" min="1" step="1" id="selec_sante">
        <div id="comm_sante"> </div>
        <div id="valeur_travail"> 3 </div>
        <input type="range" value="3" max="4" min="1" step="1" id="selec_travail">
        <div id="comm_travail"> </div>
        
        
        <div id="voyanceEnCours"> </div>
         
        <button id="bouton-prediction"> Générer Prédiction </button> 
        <button id="bouton-commencerVoyance"> Commencer la voyance </button> 
        <button id="bouton-terminerVoyance"> Terminer la voyance </button> 
        
        <!--Creates the popup body-->
        <div class="popup-overlay">
        <!--Creates the popup content-->
        <div class="popup-content">
            <h2>Terminer la Voyance</h2>
            <p> Commentaire : </p>
            <input id="champ-commentaire"/>
            <button id="bouton-envoyerCommentaire"> Terminer la voyance </button>
            <p id='error'></p>
        </div>
        </div>
        
        <script>
            
            
            
            function RemplirDonneesVoyance() {

                $.ajax({
                    url: './ActionServlet',
                    method: 'GET',
                    data: {
                        action: 'donneesVoyance'
                    },
                    dataType: 'json'
                }).done(function (data) {
                    if(data.voyanceActive){
                        //En cas de changement de voyance, on remet vide les champs qui ne sont pas toujours complétés
                        $('#promotion').empty();
                        $('#formation').empty();
                        $('#specialite').empty();
                        
                        $('#champ-civilite').html(data.clientCivilite);
                        $('#champ-nom').html(data.clientNom);
                        $('#champ-prenom').html(data.clientPrenom);
                        $('#champ-dateNaissance').html(data.clientDateNaissance);
                        $('#champ-tel').html(data.clientTel);
                        $('#champ-mail').html(data.clientMail);
                        $('#sgnAstro').html(data.clientSigneAstro);
                        $('#sgnChinois').html(data.clientSigneChinois);
                        $('#aniTotem').html(data.clientAnimalTotem);
                        $('#couleurBonheur').html(data.clientCouleur);
                        $('#nomMedium').html(data.mediumNom); 
                        $('#medium').html(data.mediumSpecialite); 
                        $('#description').html(data.mediumDescription);
                        if(data.mediumSpecialite === 'Voyant'){
                            $('#specialite').html(data.voyantSpecialite);
                        } else if(data.mediumSpecialite === 'Astrologue'){
                            $('#formation').html("Formation : " + data.astrologueFormation);
                            $('#promotion').html("Promotion : " + data.astrologuePromotion);
                        }
                        $('#tableau').empty();
                        $('#tableau').append("<tr><td> Medium </td> <td> Type de médium </td> <td> Commentaire </td> </tr>");
                        $.each(data.voyances, function(i,v){
                            $('#tableau').append("<tr><td>" + v.medium + "</td> <td>" + v.typeMedium + "</td> <td>" + v.commentaire + "</td></tr>");
                        });
                        if(data.voyanceDejaEnCours){
                            $('#voyanceEnCours').html("Voyance en cours");
                        } else {
                            $('#voyanceEnCours').html("");
                        }
                        
                    } else {
                        $('#voyance').html('Aucune voyance attribuée actuellement')
                        //A voir pour faire un truc de ce style
                        //$('#body').html("<h1> Aucune voyance attribuée actuellement </h1>");
                    }
                }).fail( function (error) { // Appel KO => erreur a gérer

                    // Popup avec message d'erreur :
                    alert('Erreur lors de l\'appel: HTTP Code ' + error.status + ' ~ ' + error.statusText + ' ~ ' + error.getResponseHeader('Content-Type'));
                    // Message d'erreur dans la div #message :
                    $('#message').html('Erreur lors de l\'appel: HTTP Code ' + error.status + ' ~ ' + error.statusText + ' ~ ' + error.getResponseHeader('Content-Type'));

                });
            }
            
            function CommencerVoyance() {

                $.ajax({
                    url: './ActionServlet',
                    method: 'GET',
                    data: {
                        action: 'commencerVoyance'
                    },
                    dataType: 'json'
                }).done(function (data) {
                    if(data.voyanceActive){
                        $('#voyanceEnCours').html("Voyance en cours");
                    } else {
                        if(data.voyanceDejaEnCours){
                            $('#voyanceEnCours').html("Voyance déja en cours");
                        } else {
                            $('#voyanceEnCours').html("Aucune voyance attribuée");
                        }
                    }
                }).fail( function (error) { // Appel KO => erreur a gérer

                    // Popup avec message d'erreur :
                    alert('Erreur lors de l\'appel: HTTP Code ' + error.status + ' ~ ' + error.statusText + ' ~ ' + error.getResponseHeader('Content-Type'));
                    // Message d'erreur dans la div #message :
                    $('#message').html('Erreur lors de l\'appel: HTTP Code ' + error.status + ' ~ ' + error.statusText + ' ~ ' + error.getResponseHeader('Content-Type'));

                });
            }
            
            function TerminerVoyance() {

                $.ajax({
                    url: './ActionServlet',
                    method: 'GET',
                    data: {
                        action: 'terminerVoyance'
                    },
                    dataType: 'json'
                }).done(function (data) {
                    if(data.voyanceEnCours){
                        $(".popup, .popup-content").addClass("active");
                        $('#voyanceEnCours').html("");
                    } else {
                        $('#voyanceEnCours').html("Aucune voyance en cours");
                    }
                }).fail( function (error) { // Appel KO => erreur a gérer

                    // Popup avec message d'erreur :
                    alert('Erreur lors de l\'appel: HTTP Code ' + error.status + ' ~ ' + error.statusText + ' ~ ' + error.getResponseHeader('Content-Type'));
                    // Message d'erreur dans la div #message :
                    $('#message').html('Erreur lors de l\'appel: HTTP Code ' + error.status + ' ~ ' + error.statusText + ' ~ ' + error.getResponseHeader('Content-Type'));

                });
            }
            
            function EnvoyerCommentaire() {
                var champCommentaire = $('#champ-commentaire').val();    
                $.ajax({
                    url: './ActionServlet',
                    method: 'GET',
                    data: {
                        commentaire: champCommentaire,
                        action: 'envoyerCommentaire'
                    },
                    dataType: 'json'
                }).done(function (data) {
                    if(data.champNonRempli){
                        $('#error').html("Vous devez remplir le champ commentaire.");
                    } else {
                        if(!data.error){
                            $(".popup, .popup-content").removeClass("active");
                            RemplirDonneesVoyance();
                        } else {
                            $('#error').html("Erreur");
                        }
                    }
                }).fail( function (error) { // Appel KO => erreur a gérer

                    // Popup avec message d'erreur :
                    alert('Erreur lors de l\'appel: HTTP Code ' + error.status + ' ~ ' + error.statusText + ' ~ ' + error.getResponseHeader('Content-Type'));
                    // Message d'erreur dans la div #message :
                    $('#message').html('Erreur lors de l\'appel: HTTP Code ' + error.status + ' ~ ' + error.statusText + ' ~ ' + error.getResponseHeader('Content-Type'));

                });
            }
            
            function GenererPredictions() {
                var selecCoeur = $('#selec_coeur').val();
                var selecSante = $('#selec_sante').val();
                var selecTravail = $('#selec_travail').val();
                $.ajax({
                    url: './ActionServlet',
                    method: 'GET',
                    data: {
                        coeur: selecCoeur,
                        sante: selecSante,
                        travail: selecTravail,
                        action: 'genererPredictions'
                    },
                    dataType: 'json'
                }).done(function (data) {
                    if(data.voyanceEnCours){
                        $('#voyanceEnCours').html("Voyance en cours");
                        $('#comm_coeur').html(data.coeur);
                        $('#comm_sante').html(data.sante);
                        $('#comm_travail').html(data.travail);
                    } else {
                        $('#voyanceEnCours').html("Aucune voyance en cours");
                    }
                }).fail( function (error) { // Appel KO => erreur a gérer

                    // Popup avec message d'erreur :
                    alert('Erreur lors de l\'appel: HTTP Code ' + error.status + ' ~ ' + error.statusText + ' ~ ' + error.getResponseHeader('Content-Type'));
                    // Message d'erreur dans la div #message :
                    $('#message').html('Erreur lors de l\'appel: HTTP Code ' + error.status + ' ~ ' + error.statusText + ' ~ ' + error.getResponseHeader('Content-Type'));

                });
            }
            
            

            $(document).ready(function () {
                // ajout d'un "handler" sur le clic du bouton de connexion
                $('#bouton-deconnexion').on('click', function () {
                    // affichage pour debugage dans la console javascript du navigateur
                    console.log('Clic sur le bouton "Déconnexion"');
                    // appel de la fonction connexion
                    window.location = "Connexion.html";
                });
                $('#bouton-tabBord').on('click', function () {
                    // affichage pour debugage dans la console javascript du navigateur
                    console.log('Clic sur le bouton "Tableau de Bord"');
                    window.location = "EmployeTabBord.html";
                });
                $('#bouton-commencerVoyance').on('click', function () {
                    // affichage pour debugage dans la console javascript du navigateur
                    console.log('Clic sur le bouton "Commencer Voyance"');
                    CommencerVoyance();
                });
                $('#bouton-terminerVoyance').on('click', function () {
                    // affichage pour debugage dans la console javascript du navigateur
                    console.log('Clic sur le bouton "Terminer Voyance"');
                    TerminerVoyance();
                });
                $('#bouton-envoyerCommentaire').on('click', function () {
                    // affichage pour debugage dans la console javascript du navigateur
                    console.log('Clic sur le bouton "Envoyer Commentaire"');
                    EnvoyerCommentaire();
                });
                $('#bouton-prediction').on('click', function () {
                    // affichage pour debugage dans la console javascript du navigateur
                    console.log('Clic sur le bouton "Generer Predictions"');
                    GenererPredictions();
                });
                $('#selec_coeur').change(function() {
                    $('#valeur_coeur').html($(this).val());
                });
                $('#selec_sante').change(function() {
                    $('#valeur_sante').html($(this).val());
                });
                $('#selec_travail').change(function() {
                    $('#valeur_travail').html($(this).val());
                });

                RemplirDonneesVoyance();
            });
        
        
        </script>
    </body>
</html>
