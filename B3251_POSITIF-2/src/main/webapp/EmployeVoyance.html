<!DOCTYPE html>
<!--
To change this license header, choose License Headers in Project Properties.
To change this template file, choose Tools | Templates
and open the template in the editor.
-->
<html>
     <head>
        <title>client</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
    </head>
    <body>
        <button id="bouton-tabBord"> Tableau de Bord </button>  
        <button id="bouton-deconnexion"> Deconnexion </button>  <br>
        
        <h1 id="voyance">Voyance attribuée : </h1>
        <h1> Profil Client </h1> <br>
        Civilité : <div id="champ-civilite"></div><br>
        Nom : <div id="champ-nom"></div><br>
        Prénom : <div id="champ-prenom"></div><br>
        Date de Naissance : <div id="champ-dateNaissance"></div><br>
        Tel : <div id="champ-tel"></div><br>
        Mail : <div id="champ-mail"></div><br>
        <h1> Astrologie  </h1> <br>
        Signe astrologique : <div id='sgnAstro'> </div> <br>
        Signe chinois : <div id='sgnChinois'> </div> <br>
        Animal totem : <div id='aniTotem'> </div> <br>
        Couleur porte-bonheur : <div id='couleurBonheur'> </div> <br>
        <h1> Medium à incarner  </h1> <br>
        Nom : <div id='nomMedium'> </div> <br>
        Medium : <div id='medium'> </div> <br>
        Description : <div id='description'> </div> <br>
        <div id='specialite'> </div> <br>
        <div id='formation'> </div> <br>
        <div id='promotion'> </div> <br>
        <table id='tableau' border="1" width="100%">
            <tr>
                <td> Medium </td>
                <td> Type de médium </td>
                <td> Commentaire </td>
            </tr>
        </table> 
        <h1> Générateur de Prédiction </h1>
        <div id="coeur"> </div>
        <div id="sante"> </div>
        <div id="travail"> </div>
        
        <div id="voyanceRunning"> </div>
        <div id="popup"> </div>
         
        <button id="bouton-prediction"> Générer Prédiction </button> 
        <button id="bouton-commencerVoyance"> Commencer la voyance </button> 
        <button id="bouton-terminerVoyance"> Terminer la voyance </button> 
        <script>
            function RemplirDonneesVoyance() {

                $.ajax({
                    url: './ActionServlet',
                    method: 'GET',
                    data: {
                        action: 'donneesVoyance'
                    },
                    dataType: 'json'
                }).done(function (data) {
                    if(data.voyanceActive){
                        //En cas de changement de voyance, on remet vide les champs qui ne sont pas toujours complétés
                        $('#promotion').empty();
                        $('#formation').empty();
                        $('#specialite').empty();
                        
                        $('#champ-civilite').html(data.clientCivilite);
                        $('#champ-nom').html(data.clientNom);
                        $('#champ-prenom').html(data.clientPrenom);
                        $('#champ-dateNaissance').html(data.clientDateNaissance);
                        $('#champ-tel').html(data.clientTel);
                        $('#champ-mail').html(data.clientMail);
                        $('#sgnAstro').html(data.clientSigneAstro);
                        $('#sgnChinois').html(data.clientSigneChinois);
                        $('#aniTotem').html(data.clientAnimalTotem);
                        $('#couleurBonheur').html(data.clientCouleur);
                        $('#nomMedium').html(data.mediumNom); 
                        $('#medium').html(data.mediumSpecialite); 
                        $('#description').html(data.mediumDescription);
                        if(data.mediumSpecialite === 'Voyant'){
                            $('#specialite').html(data.voyantSpecialite);
                        } else if(data.mediumSpecialite === 'Astrologue'){
                            $('#formation').html("Formation : " + data.astrologueFormation);
                            $('#promotion').html("Promotion : " + data.astrologuePromotion);
                        }
                        $('#tableau').empty();
                        $('#tableau').append("<tr><td> Medium </td> <td> Type de médium </td> <td> Commentaire </td> </tr>");
                        $.each(data.voyances, function(i,v){
                            $('#tableau').append("<tr><td>" + v.medium + "</td> <td>" + v.typeMedium + "</td> <td>" + v.commentaire + "</td></tr>");
                        });
                        
                    } else {
                        $('#voyance').html('Aucune voyance attribuée actuellement');
                    }
                }).fail( function (error) { // Appel KO => erreur a gérer

                    // Popup avec message d'erreur :
                    alert('Erreur lors de l\'appel: HTTP Code ' + error.status + ' ~ ' + error.statusText + ' ~ ' + error.getResponseHeader('Content-Type'));
                    // Message d'erreur dans la div #message :
                    $('#message').html('Erreur lors de l\'appel: HTTP Code ' + error.status + ' ~ ' + error.statusText + ' ~ ' + error.getResponseHeader('Content-Type'));

                });
            }
            
            function CommencerVoyance() {

                $.ajax({
                    url: './ActionServlet',
                    method: 'GET',
                    data: {
                        action: 'commencerVoyance'
                    },
                    dataType: 'json'
                }).done(function (data) {
                    if(data.voyanceActive){
                        $('#voyanceRunning').html("Voyance en cours");
                    } else {
                        if(data.voyanceDejaEnCours){
                            $('#voyanceRunning').html("Voyage déja en cours");
                        } else {
                            $('#voyanceRunning').html("Aucune voyance attribuée");
                        }
                    }
                }).fail( function (error) { // Appel KO => erreur a gérer

                    // Popup avec message d'erreur :
                    alert('Erreur lors de l\'appel: HTTP Code ' + error.status + ' ~ ' + error.statusText + ' ~ ' + error.getResponseHeader('Content-Type'));
                    // Message d'erreur dans la div #message :
                    $('#message').html('Erreur lors de l\'appel: HTTP Code ' + error.status + ' ~ ' + error.statusText + ' ~ ' + error.getResponseHeader('Content-Type'));

                });
            }
            
            function TerminerVoyance() {

                $.ajax({
                    url: './ActionServlet',
                    method: 'GET',
                    data: {
                        action: 'terminerVoyance'
                    },
                    dataType: 'json'
                }).done(function (data) {
                    if(data.voyanceEnCours){
                        $('#popup').html("POPUP");
                    } else {
                        $('#popup').html("Aucune voyance en cours");
                    }
                }).fail( function (error) { // Appel KO => erreur a gérer

                    // Popup avec message d'erreur :
                    alert('Erreur lors de l\'appel: HTTP Code ' + error.status + ' ~ ' + error.statusText + ' ~ ' + error.getResponseHeader('Content-Type'));
                    // Message d'erreur dans la div #message :
                    $('#message').html('Erreur lors de l\'appel: HTTP Code ' + error.status + ' ~ ' + error.statusText + ' ~ ' + error.getResponseHeader('Content-Type'));

                });
            }
            
            

            $(document).ready(function () {
                // ajout d'un "handler" sur le clic du bouton de connexion
                $('#bouton-deconnexion').on('click', function () {
                    // affichage pour debugage dans la console javascript du navigateur
                    console.log('Clic sur le bouton "Déconnexion"');
                    // appel de la fonction connexion
                    window.location = "Connexion.html";
                });
                $('#bouton-tabBord').on('click', function () {
                    // affichage pour debugage dans la console javascript du navigateur
                    console.log('Clic sur le bouton "Tableau de Bord"');
                    window.location = "EmployeTabBord.html";
                });
                 $('#bouton-commencerVoyance').on('click', function () {
                    // affichage pour debugage dans la console javascript du navigateur
                    console.log('Clic sur le bouton "Commencer Voyance"');
                    CommencerVoyance();
                });
                 $('#bouton-terminerVoyance').on('click', function () {
                    // affichage pour debugage dans la console javascript du navigateur
                    console.log('Clic sur le bouton "Terminer Voyance"');
                    TerminerVoyance();
                });

                RemplirDonneesVoyance();
            });
        
        
        </script>
    </body>
</html>
