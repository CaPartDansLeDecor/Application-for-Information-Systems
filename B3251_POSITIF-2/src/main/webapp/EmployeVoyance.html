<!DOCTYPE html>
<!--
To change this license header, choose License Headers in Project Properties.
To change this template file, choose Tools | Templates
and open the template in the editor.
-->
<html>
    <head>

        <link rel="stylesheet" href="style.css" type="text/css"/>
        <link rel="stylesheet" href="main-layout.css" />
        <link rel="stylesheet" href="EmployeVoyance.css" />
        <title>Positif - Voyance</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
        <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
        <link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
    </head>
    <body>
        <div class="full-page">
            <div class="toolbar">
                <button id="bouton-voyance" class="menu-btn selected">Voyance</button>
                <button id="bouton-stats" class="menu-btn">Tableau de Bord</button>
            </div>

            <div class="main-content" style="flex-direction: column; text-align: left;">
                <div style="flex: 0 1 35%; width: 100%; display:flex;">
                    <div style="flex: 0 0 500px; width: 100%; margin-left : 50px; ">
                        <div class="content-column-title"><span class="underlined">Profil Client</span></div>
                        <div class="form-line"> Civilité : <span id="champ-civilite"></span></div>
                        <div class="form-line">Nom : <span id="champ-nom"></span></div>
                        <div class="form-line">Prénom : <span id="champ-prenom"></span></div>
                        <div class="form-line">Date de Naissance : <span id="champ-dateNaissance"></span></div>
                        <div class="form-line">Tel : <span id="champ-tel"></span></div>
                        <div class="form-line">Mail : <span id="champ-mail"></span></div>
                    </div>
                    <div style="flex: 1 1 auto;width: 100%;display:flex; justify-content: center; overflow-y: auto; max-height: 100%;">
                        <table id='tableau' border="1" width="95%" style="margin: 16px 0;">
                            <tr style="background-color:blue;">
                                <td> Medium </td>
                                <td> Type de médium </td>
                                <td> Commentaire </td>
                            </tr>
                        </table>
                    </div>
                </div>
                <div class="separator"> </div>
                <div style="flex: 0 1 65%   ;width: 100%;display:flex;">
                    <div style="flex: 0 0 500px; width: 100%; margin-left : 50px;">
                        <div class="content-column-title"><span class="underlined">Astrologie</span></div>
                        <div class="form-line"> Signe astrologique : <span id='sgnAstro'> </span> </div>
                        <div class="form-line"> Signe chinois : <span id='sgnChinois'> </span> </div>
                        <div class="form-line"> Animal totem : <span id='aniTotem'> </span> </div>
                        <div class="form-line"> Couleur porte-bonheur : <span id='couleurBonheur'> </span></div> 
                        <div class="content-column-title"><span class="underlined">Medium à incarner</span></div>
                        <div class="form-line"> Nom : <span id='nomMedium'> </span> </div>
                        <div class="form-line"> Medium : <span id='medium'> </span> </div>
                        <div class="form-line"> Description : <span id='description'> </span> </div> 
                        <div class="form-line" id='specialite'> </div>
                        <div class="form-line" id='formation'> </div>
                        <div class="form-line" id='promotion'> </div> 
                    </div>
                    <div style="flex: 1 1 auto;width: 100%;display:flex; flex-direction: column;">
                        <div style="flex: 0 0 80px;">
                            <div class="content-column-title" style="margin-left: 2.5%"><span class="underlined">Générateur de Prédictions</span></div> 
                        </div>
                        <div style="flex: 1 0 auto; display: flex;">
                            <div style="flex: 0 0 33.3%; display: flex; flex-direction: column; align-items: center;">
                                <img src="heart.PNG" style="height:100px;">
                                <div id="valeur_coeur"> 3 </div>
                                <input type="range" value="3" max="4" min="1" step="1" id="selec_coeur">
                                <div style="flex-grow:1; width: 100%; display: flex; align-items: center; justify-content: center;">
                                    <div id="comm_coeur" style="width: 80%; height: 85%; border: solid 1px #6d88a2; border-radius: 16px;white-space: normal; padding: 8px; font-size: 20px;"></div>
                                </div>
                            </div>
                            <div style="flex: 0 0 33.3%; display: flex; flex-direction: column; align-items: center;">
                                <img src="plus.PNG" style="height:100px;">
                                <div id="valeur_sante"> 3 </div>
                                <input type="range" value="3" max="4" min="1" step="1" id="selec_sante">
                                <div style="flex-grow:1; width: 100%; display: flex; align-items: center; justify-content: center;">
                                    <div id="comm_sante" style="width: 80%; height: 85%; border: solid 1px #6d88a2; border-radius: 16px; padding: 8px; font-size: 20px;"></div>
                                </div>
                            </div>
                            <div style="flex: 0 0 33.3%; display: flex; flex-direction: column; align-items: center;">
                                <img src="valise.PNG" style="height:100px;">
                                <div id="valeur_travail"> 3 </div>
                                <input type="range" value="3" max="4" min="1" step="1" id="selec_travail">
                                <div style="flex-grow:1; width: 100%; display: flex; align-items: center; justify-content: center;">
                                    <div id="comm_travail" style="width: 80%; height: 85%; border: solid 1px #6d88a2; border-radius: 16px; padding: 8px; font-size: 20px;"></div>
                                </div>
                            </div>
                        </div>
                        <div style="flex: 0 0 80px;display: flex; align-items: center">
                            <button id="bouton-prediction" class="bouton"> Générer Prédiction </button>
                            <span id="voyanceEnCours" style="flex-grow: 1; text-align: center; font-size: 20px;"></span>
                            <button id="bouton-commencerVoyance" class="bouton"> Commencer la voyance </button> 
                            <button id="bouton-terminerVoyance" class="bouton"> Terminer la voyance </button>
                        </div>
                    </div>
                </div>
            </div>
            <div id="bouton-deconnexion" class="bouton">Déconnexion</div>
        </div>


        <div id="voyance-form" title="Terminer la Voyance">
            <div style="text-align: left; margin: 12px 20px; font-size: 20px; font-weight: bold;color: #253D7E;">Commentaire :</div>
            <textarea class="voyance-comment" placeholder="Laissez un commentaire..."></textarea>
            <div id="error"></div>
        </div>

        <script>
            function RemplirDonneesVoyance() {

                $.ajax({
                    url: './ActionServlet',
                    method: 'GET',
                    data: {
                        action: 'donneesVoyance'
                    },
                    dataType: 'json'
                }).done(function (data) {
                    if (data.voyanceActive) {
                        //En cas de changement de voyance, on remet vide les champs qui ne sont pas toujours complétés
                        $('#promotion').empty();
                        $('#formation').empty();
                        $('#specialite').empty();

                        $('#champ-civilite').html(data.clientCivilite);
                        $('#champ-nom').html(data.clientNom);
                        $('#champ-prenom').html(data.clientPrenom);
                        $('#champ-dateNaissance').html(data.clientDateNaissance);
                        $('#champ-tel').html(data.clientTel);
                        $('#champ-mail').html(data.clientMail);
                        $('#sgnAstro').html(data.clientSigneAstro);
                        $('#sgnChinois').html(data.clientSigneChinois);
                        $('#aniTotem').html(data.clientAnimalTotem);
                        $('#couleurBonheur').html(data.clientCouleur);
                        $('#nomMedium').html(data.mediumNom);
                        $('#medium').html(data.mediumSpecialite);
                        $('#description').html(data.mediumDescription);
                        if (data.mediumSpecialite === 'Voyant') {
                            $('#specialite').html(data.voyantSpecialite);
                        } else if (data.mediumSpecialite === 'Astrologue') {
                            $('#formation').html("Formation : " + data.astrologueFormation);
                            $('#promotion').html("Promotion : " + data.astrologuePromotion);
                        }
                        $('#tableau').empty();
                        $('#tableau').append("<tr style='background-color: blue; color:white;'><td> Medium </td> <td> Type de médium </td> <td> Commentaire </td> </tr>");
                        $.each(data.voyances, function (i, v) {
                            $('#tableau').append("<tr><td>" + v.medium + "</td> <td>" + v.typeMedium + "</td> <td>" + v.commentaire + "</td></tr>");
                        });
                        if (data.voyanceDejaEnCours) {
                            $('#voyanceEnCours').html("Voyance en cours");
                        } else {
                            $('#voyanceEnCours').html("");
                        }

                    } else {
                        $(".main-content").empty().html('<div style="font-size: 20px; margin-top: 32px;">Aucune voyance en cours.</div>');
                    }
                }).fail(function (error) { // Appel KO => erreur a gérer

                    // Popup avec message d'erreur :
                    alert('Erreur lors de l\'appel: HTTP Code ' + error.status + ' ~ ' + error.statusText + ' ~ ' + error.getResponseHeader('Content-Type'));
                    // Message d'erreur dans la div #message :
                    $('#message').html('Erreur lors de l\'appel: HTTP Code ' + error.status + ' ~ ' + error.statusText + ' ~ ' + error.getResponseHeader('Content-Type'));

                });
            }

            function CommencerVoyance() {

                $.ajax({
                    url: './ActionServlet',
                    method: 'GET',
                    data: {
                        action: 'commencerVoyance'
                    },
                    dataType: 'json'
                }).done(function (data) {
                    if (data.voyanceActive) {
                        $('#voyanceEnCours').html("Voyance en cours");
                    } else {
                        if (data.voyanceDejaEnCours) {
                            $('#voyanceEnCours').html("Voyance déja en cours");
                        } else {
                            $('#voyanceEnCours').html("Aucune voyance attribuée");
                        }
                    }
                }).fail(function (error) { // Appel KO => erreur a gérer

                    // Popup avec message d'erreur :
                    alert('Erreur lors de l\'appel: HTTP Code ' + error.status + ' ~ ' + error.statusText + ' ~ ' + error.getResponseHeader('Content-Type'));
                    // Message d'erreur dans la div #message :
                    $('#message').html('Erreur lors de l\'appel: HTTP Code ' + error.status + ' ~ ' + error.statusText + ' ~ ' + error.getResponseHeader('Content-Type'));

                });
            }

            function TerminerVoyance() {

                $.ajax({
                    url: './ActionServlet',
                    method: 'GET',
                    data: {
                        action: 'terminerVoyance'
                    },
                    dataType: 'json'
                }).done(function (data) {
                    if (data.voyanceEnCours) {
                        $("#voyance-form").dialog('open');
                    } else {
                        $('#voyanceEnCours').html("Aucune voyance en cours");
                    }
                }).fail(function (error) { // Appel KO => erreur a gérer

                    // Popup avec message d'erreur :
                    alert('Erreur lors de l\'appel: HTTP Code ' + error.status + ' ~ ' + error.statusText + ' ~ ' + error.getResponseHeader('Content-Type'));
                    // Message d'erreur dans la div #message :
                    $('#message').html('Erreur lors de l\'appel: HTTP Code ' + error.status + ' ~ ' + error.statusText + ' ~ ' + error.getResponseHeader('Content-Type'));

                });
            }

            function EnvoyerCommentaire() {
                var champCommentaire = $('.voyance-comment').val();
                $.ajax({
                    url: './ActionServlet',
                    method: 'GET',
                    data: {
                        commentaire: champCommentaire,
                        action: 'envoyerCommentaire'
                    },
                    dataType: 'json'
                }).done(function (data) {
                    if (data.champNonRempli) {
                        $('#error').html("Vous devez remplir le champ commentaire.");
                    } else {
                        if (!data.error) {
                            $('#voyance-form').dialog('close');
                            $(".main-content").empty().html('<div style="font-size: 20px; margin-top: 32px;">Aucune voyance en cours.</div>');
                            RemplirDonneesVoyance();
                        } else {
                            $('#error').html("Erreur");
                        }
                    }
                }).fail(function (error) { // Appel KO => erreur a gérer

                    // Popup avec message d'erreur :
                    alert('Erreur lors de l\'appel: HTTP Code ' + error.status + ' ~ ' + error.statusText + ' ~ ' + error.getResponseHeader('Content-Type'));
                    // Message d'erreur dans la div #message :
                    $('#message').html('Erreur lors de l\'appel: HTTP Code ' + error.status + ' ~ ' + error.statusText + ' ~ ' + error.getResponseHeader('Content-Type'));

                });
            }

            function GenererPredictions() {
                var selecCoeur = $('#selec_coeur').val();
                var selecSante = $('#selec_sante').val();
                var selecTravail = $('#selec_travail').val();
                $.ajax({
                    url: './ActionServlet',
                    method: 'GET',
                    data: {
                        coeur: selecCoeur,
                        sante: selecSante,
                        travail: selecTravail,
                        action: 'genererPredictions'
                    },
                    dataType: 'json'
                }).done(function (data) {
                    if (data.voyanceEnCours) {
                        $('#voyanceEnCours').html("Voyance en cours");
                        $('#comm_coeur').html(data.coeur);
                        $('#comm_sante').html(data.sante);
                        $('#comm_travail').html(data.travail);
                    } else {
                        $('#voyanceEnCours').html("Aucune voyance en cours");
                    }
                }).fail(function (error) { // Appel KO => erreur a gérer

                    // Popup avec message d'erreur :
                    alert('Erreur lors de l\'appel: HTTP Code ' + error.status + ' ~ ' + error.statusText + ' ~ ' + error.getResponseHeader('Content-Type'));
                    // Message d'erreur dans la div #message :
                    $('#message').html('Erreur lors de l\'appel: HTTP Code ' + error.status + ' ~ ' + error.statusText + ' ~ ' + error.getResponseHeader('Content-Type'));

                });
            }



            $(document).ready(function () {

                $("#voyance-form").dialog({
                    autoOpen: false,
                    resizable: false,
                    draggable: false,
                    height: 450,
                    width: 500,
                    modal: true,
                    buttons: {
                        "Envoyer": function () {
                            EnvoyerCommentaire();
                        },
                        "Annuler": function () {
                            $('#voyance-form').dialog("close");
                        }
                    }
                });

                // ajout d'un "handler" sur le clic du bouton de connexion
                $('#bouton-deconnexion').on('click', function () {
                    // affichage pour debugage dans la console javascript du navigateur
                    console.log('Clic sur le bouton "Déconnexion"');
                    // appel de la fonction connexion
                    window.location = "Connexion.html";
                });
                $('#bouton-stats').on('click', function () {
                    // affichage pour debugage dans la console javascript du navigateur
                    console.log('Clic sur le bouton "Tableau de Bord"');
                    window.location = "EmployeTabBord.html";
                });
                $('#bouton-commencerVoyance').on('click', function () {
                    // affichage pour debugage dans la console javascript du navigateur
                    console.log('Clic sur le bouton "Commencer Voyance"');
                    CommencerVoyance();
                });
                $('#bouton-terminerVoyance').on('click', function () {
                    // affichage pour debugage dans la console javascript du navigateur
                    console.log('Clic sur le bouton "Terminer Voyance"');
                    TerminerVoyance();
                });
                $('#bouton-envoyerCommentaire').on('click', function () {
                    // affichage pour debugage dans la console javascript du navigateur
                    console.log('Clic sur le bouton "Envoyer Commentaire"');
                    EnvoyerCommentaire();
                });
                $('#bouton-prediction').on('click', function () {
                    // affichage pour debugage dans la console javascript du navigateur
                    console.log('Clic sur le bouton "Generer Predictions"');
                    GenererPredictions();
                });
                $('#selec_coeur').change(function () {
                    $('#valeur_coeur').html($(this).val());
                });
                $('#selec_sante').change(function () {
                    $('#valeur_sante').html($(this).val());
                });
                $('#selec_travail').change(function () {
                    $('#valeur_travail').html($(this).val());
                });

                RemplirDonneesVoyance();
            });


        </script>
    </body>
</html>
